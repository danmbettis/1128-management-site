<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>1128 Management Corp â€“ Client Portal</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet" />
  <style>
    :root {
      --bg: #050816;
      --bg-card: #111827;
      --border: #1f2937;
      --text: #f9fafb;
      --muted: #9ca3af;
      --accent: #2563eb;
      --accent-soft: #1d4ed8;
    }
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    body {
      font-family: "Inter", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #111827 0, #020617 50%, #000 100%);
      color: var(--text);
      line-height: 1.6;
    }
    a {
      color: var(--accent);
      text-decoration: none;
    }
    a:hover {
      text-decoration: underline;
    }
    .container {
      max-width: 1000px;
      margin: 0 auto;
      padding: 24px 16px 48px;
    }
    header {
      padding: 16px 16px 8px;
      border-bottom: 1px solid rgba(31,41,55,0.8);
      background: rgba(15,23,42,0.96);
      position: sticky;
      top: 0;
      z-index: 10;
    }
    .nav {
      max-width: 1000px;
      margin: 0 auto;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
    }
    .logo-block {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .logo-mark {
      width: 36px;
      height: 36px;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: radial-gradient(circle at 10% 0, #38bdf8, #4f46e5, #0f172a);
      border: 1px solid rgba(148,163,184,0.7);
      font-weight: 700;
      font-size: 0.9rem;
    }
    .logo-text {
      display: flex;
      flex-direction: column;
    }
    .logo-text span:first-child {
      font-size: 0.95rem;
      font-weight: 600;
      letter-spacing: 0.05em;
      text-transform: uppercase;
    }
    .logo-text span:last-child {
      font-size: 0.75rem;
      color: var(--muted);
    }
    .nav-cta {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      justify-content: flex-end;
    }
    .pill {
      font-size: 0.7rem;
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.5);
      color: var(--muted);
    }
    .btn, .btn-outline {
      border-radius: 999px;
      padding: 8px 16px;
      font-size: 0.8rem;
      border: none;
      cursor: pointer;
      font-family: inherit;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 4px;
    }
    .btn {
      background: linear-gradient(to right, var(--accent), var(--accent-soft));
      color: white;
      box-shadow: 0 14px 35px rgba(37,99,235,0.45);
    }
    .btn[disabled] {
      opacity: 0.6;
      cursor: default;
      box-shadow: none;
    }
    .btn-outline {
      background: transparent;
      border: 1px solid rgba(148,163,184,0.7);
      color: var(--text);
    }

    .layout {
      display: grid;
      grid-template-columns: minmax(0, 1.5fr) minmax(0, 1.2fr);
      gap: 24px;
      margin-top: 24px;
    }
    @media (max-width: 900px) {
      .layout {
        grid-template-columns: minmax(0,1fr);
      }
    }

    .card {
      background: var(--bg-card);
      border-radius: 16px;
      padding: 18px 18px 20px;
      border: 1px solid var(--border);
    }
    h1 {
      font-size: 1.9rem;
      margin-bottom: 8px;
    }
    h2 {
      font-size: 1.1rem;
      margin-bottom: 8px;
    }
    h3 {
      font-size: 1rem;
      margin-bottom: 6px;
    }
    p {
      font-size: 0.9rem;
      color: var(--muted);
    }
    .hero-eyebrow {
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.18em;
      color: #22c55e;
      margin-bottom: 6px;
    }
    .hero-meta {
      margin-top: 8px;
      font-size: 0.8rem;
      color: var(--muted);
    }
    .hero-meta span {
      display: block;
    }

    label {
      font-size: 0.8rem;
      display: block;
      margin-top: 8px;
      margin-bottom: 3px;
    }
    input {
      width: 100%;
      padding: 8px 10px;
      border-radius: 8px;
      border: 1px solid var(--border);
      background: #020617;
      color: var(--text);
      font-size: 0.85rem;
      outline: none;
    }
    input::placeholder {
      color: #6b7280;
    }
    .login-actions {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 14px;
      align-items: center;
    }
    .helper-text {
      font-size: 0.75rem;
      color: var(--muted);
      margin-top: 8px;
    }

    #dashboard-locked-msg {
      margin-top: 24px;
      font-size: 0.85rem;
      color: var(--muted);
    }
    #dashboard-wrapper {
      margin-top: 24px;
    }

    .badge-role {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 2px 10px;
      border-radius: 999px;
      border: 1px solid rgba(59,130,246,0.7);
      font-size: 0.75rem;
    }

    ul.status-list, ul.doc-list {
      list-style: none;
      padding-left: 0;
      margin-top: 6px;
      font-size: 0.85rem;
      color: var(--muted);
    }
    ul.status-list li::before {
      content: "â€¢ ";
      color: #22c55e;
    }
    ul.doc-list li::before {
      content: "â†— ";
      color: #38bdf8;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 8px;
      font-size: 0.8rem;
    }
    th, td {
      padding: 6px 4px;
      border-bottom: 1px solid var(--border);
      text-align: left;
    }
    th {
      text-transform: uppercase;
      letter-spacing: 0.1em;
      font-size: 0.7rem;
      color: var(--muted);
    }

    footer {
      border-top: 1px solid rgba(31,41,55,0.8);
      padding: 16px;
      font-size: 0.8rem;
      color: var(--muted);
      text-align: center;
      background: rgba(15,23,42,0.96);
      margin-top: 40px;
    }
  </style>
</head>
<body>
  <header>
    <div class="nav">
      <div class="logo-block">
        <div class="logo-mark">1128</div>
        <div class="logo-text">
          <span>1128 Management Corp</span>
          <span>C-Corp Setup â€¢ Management â€¢ Portal</span>
        </div>
      </div>
      <div class="nav-cta">
        <span class="pill">Mississippi â€¢ Multi-Entity</span>
        <button class="btn-outline" onclick="document.getElementById('login-card').scrollIntoView({behavior:'smooth'})">
          Client Portal Login
        </button>
      </div>
    </div>
  </header>

    <div class="container">
      <div class="layout">
        <!-- LEFT: SIMPLE OVERVIEW -->
        <div>
          <div class="card">
            <div class="hero-eyebrow">Client Portal</div>
            <h1>Track your setup, management, and documentation in one place.</h1>
            <p>
              1128 Management Corp uses this portal to keep clients updated on
              C-Corporation setup, management work, document status, and ongoing support.
              You will see updates, notes, and document links once we begin work on your file.
            </p>
            <div class="hero-meta">
              <span>â€¢ For paying clients of 1128 Management Corp.</span>
              <span>â€¢ Each person has their own email + password login.</span>
              <span>â€¢ Status and documents are updated by 1128 on the backend.</span>
            </div>
          </div>

          <div class="card" style="margin-top:18px;">
            <h2>How it works for you</h2>
            <p>
              1) You complete payment and intake.  
              2) You create your portal login using the same email you gave us.  
              3) We update your file inside our system.  
              4) When you log in, you can see:
            </p>
            <ul class="status-list" style="margin-top:6px;">
              <li>Overall status of your setup / management / evaluation</li>
              <li>Key steps and their current stage (Complete / In Progress / Pending)</li>
              <li>Links to important documents we have placed on file for you</li>
            </ul>
          </div>
        </div>

        <!-- RIGHT: LOGIN + PORTAL -->
        <div id="login-card" class="card">
          <h2>Client Login</h2>
          <p class="helper-text">
            This login is for 1128 Management Corp clients.  
            New registrations created here are automatically treated as <strong>Clients</strong>.
          </p>

          <label for="login-email">Email</label>
          <input id="login-email" type="email" placeholder="you@email.com" autocomplete="email" />

          <label for="login-password">Password</label>
          <input id="login-password" type="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" autocomplete="current-password" />

          <!-- Hidden role selector: public cannot choose Staff/Admin -->
          <div style="display:none;">
            <label for="login-role">Role</label>
            <select id="login-role">
              <option value="client" selected>Client</option>
            </select>
          </div>

          <div class="login-actions">
            <button id="login-btn" class="btn" type="button" onclick="handleLogin()">
              Login
            </button>
            <button id="register-btn" class="btn-outline" type="button" onclick="handleRegister()">
              Register New Client Account
            </button>
          </div>

          <p class="helper-text">
            Use <strong>Register</strong> only once per email. If you forget your password, use the password reset
            link in your email provider once we enable it, or contact 1128 for assistance.
          </p>
        </div>
      </div>

      <!-- LOCKED MESSAGE -->
      <div id="dashboard-locked-msg">
        You must be logged in to see your internal status and documents.
      </div>

      <!-- DASHBOARD / PORTAL -->
      <section id="dashboard-wrapper" style="display:none;">
        <div class="card">
          <div style="display:flex; justify-content:space-between; align-items:center; gap:8px; flex-wrap:wrap;">
            <div>
              <h2>Client Portal Dashboard</h2>
              <p class="helper-text" style="margin-top:2px;">
                This area shows information based on your account and role. Most users will be <strong>Clients</strong>.
              </p>
            </div>
            <div style="text-align:right;">
              <span style="font-size:0.8rem; color:var(--muted);">Logged in as:</span><br />
              <span id="sidebar-role-label" class="badge-role">Guest</span>
              <div style="margin-top:6px;">
                <button class="btn-outline" style="font-size:0.75rem; padding:4px 10px;" type="button" onclick="handleLogout()">
                  Logout
                </button>
              </div>
            </div>
          </div>

          <!-- CLIENT PANEL -->
          <div id="client-dashboard-panel" style="margin-top:18px; display:none;">
            <h3>My Setup / Management / Evaluation Status</h3>
            <p id="client-funding-status" style="margin-top:4px;"></p>

            <h4 style="margin-top:14px; font-size:0.9rem;">Key Steps</h4>
            <ul id="client-funding-steps" class="status-list"></ul>

            <h4 style="margin-top:14px; font-size:0.9rem;">Documents on File</h4>
            <ul id="client-documents" class="doc-list"></ul>
          </div>

          <!-- ADMIN / STAFF VIEW (simple demo table for future use) -->
          <div id="admin-staff-note" style="margin-top:18px; display:none;">
            <h3>Admin / Staff Note</h3>
            <p class="helper-text">
              This area is reserved for internal use (future expansion: client list, intakes, tasks, etc.).
              Staff and Admin roles are managed by 1128 inside Firebase, not by public registration.
            </p>
          </div>
        </div>
      </section>
    </div>

  <footer>
    Â© <span id="year"></span> 1128 Management Corp. Client Portal.
  </footer>

  <!-- FIREBASE + PORTAL LOGIC -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-app.js";
    import {
      getAuth,
      onAuthStateChanged,
      createUserWithEmailAndPassword,
      signInWithEmailAndPassword,
      signOut
    } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-auth.js";
    import {
      getFirestore,
      doc,
      getDoc,
      setDoc
    } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-firestore.js";

    // âœ… Your working Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyDWgaRI40PO-fgP8xa_m1OWg-3AgOKCQW4",
      authDomain: "management-portal-da4aa.firebaseapp.com",
      projectId: "management-portal-da4aa",
      storageBucket: "management-portal-da4aa.firebasestorage.app",
      messagingSenderId: "336550662632",
      appId: "1:336550662632:web:da5a240a56fdd2df3a145d",
      measurementId: "G-CCWG9GVVS7"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // ---------- UI helpers ----------
    function setLoading(buttonId, isLoading, labelWhenIdle, labelWhenLoading) {
      const btn = document.getElementById(buttonId);
      if (!btn) return;
      btn.disabled = isLoading;
      btn.textContent = isLoading ? labelWhenLoading : labelWhenIdle;
    }

    function applyRoleUI(role) {
      const dashboard = document.getElementById("dashboard-wrapper");
      const lockMsg = document.getElementById("dashboard-locked-msg");
      const roleLabel = document.getElementById("sidebar-role-label");
      const clientPanel = document.getElementById("client-dashboard-panel");
      const adminStaffNote = document.getElementById("admin-staff-note");

      const normalizedRole = (role || "guest").toLowerCase();

      if (!dashboard || !lockMsg || !roleLabel) return;

      if (normalizedRole === "guest") {
        dashboard.style.display = "none";
        lockMsg.style.display = "block";
        roleLabel.textContent = "Guest";
        if (clientPanel) clientPanel.style.display = "none";
        if (adminStaffNote) adminStaffNote.style.display = "none";
        return;
      }

      // Logged in
      dashboard.style.display = "block";
      lockMsg.style.display = "none";
      roleLabel.textContent = normalizedRole.charAt(0).toUpperCase() + normalizedRole.slice(1);

      if (normalizedRole === "client") {
        if (clientPanel) clientPanel.style.display = "block";
        if (adminStaffNote) adminStaffNote.style.display = "none";
      } else {
        // For future: staff/admin view
        if (clientPanel) clientPanel.style.display = "none";
        if (adminStaffNote) adminStaffNote.style.display = "block";
      }
    }

    async function loadClientFundingStatus(user) {
      const statusEl = document.getElementById("client-funding-status");
      const stepsEl = document.getElementById("client-funding-steps");
      const docsEl = document.getElementById("client-documents");

      if (!statusEl || !stepsEl || !docsEl) return;

      try {
        const ref = doc(db, "fundingStatus", user.uid);
        const snap = await getDoc(ref);

        if (!snap.exists()) {
          statusEl.textContent =
            "Weâ€™ve received your account. Your file will appear here once 1128 adds your details and documents.";
          stepsEl.innerHTML = "";
          docsEl.innerHTML = "";
          return;
        }

        const data = snap.data();

        // Overall status
        statusEl.textContent = data.overallStatus || "In progress.";

        // Steps
        const steps = data.steps || [];
        stepsEl.innerHTML = "";
        if (!steps.length) {
          const li = document.createElement("li");
          li.textContent = "No steps have been added yet.";
          stepsEl.appendChild(li);
        } else {
          steps.forEach((step) => {
            const li = document.createElement("li");
            li.textContent = `${step.label}: ${step.status}`;
            stepsEl.appendChild(li);
          });
        }

        // Documents
        const docs = data.documents || [];
        docsEl.innerHTML = "";
        if (!docs.length) {
          const li = document.createElement("li");
          li.textContent = "No documents have been attached yet.";
          docsEl.appendChild(li);
        } else {
          docs.forEach((docItem) => {
            const li = document.createElement("li");
            const a = document.createElement("a");
            a.href = docItem.url;
            a.target = "_blank";
            a.rel = "noopener noreferrer";
            a.textContent = docItem.label || docItem.url;
            li.appendChild(a);
            docsEl.appendChild(li);
          });
        }
      } catch (err) {
        console.error(err);
        statusEl.textContent = "We couldnâ€™t load your file right now. Please try again later.";
        stepsEl.innerHTML = "";
        docsEl.innerHTML = "";
      }
    }

    // ---------- Auth: register/login/logout ----------

    // ðŸ” PUBLIC REGISTRATION â€” CLIENT ONLY
    async function handleRegister() {
      const emailInput = document.getElementById("login-email");
      const passwordInput = document.getElementById("login-password");

      const email = (emailInput?.value || "").trim();
      const password = passwordInput?.value || "";

      if (!email || !password) {
        alert("Please enter an email and password.");
        return;
      }

      const role = "client"; // hard-locked

      try {
        setLoading("register-btn", true, "Register New Client Account", "Registering...");
        const cred = await createUserWithEmailAndPassword(auth, email, password);

        await setDoc(doc(db, "users", cred.user.uid), {
          email,
          role,
          createdAt: Date.now()
        });

        await setDoc(doc(db, "fundingStatus", cred.user.uid), {
          overallStatus: "Weâ€™ve received your account. Intake and setup steps will be added by 1128.",
          steps: [
            { label: "Client portal account created", status: "Complete" },
            { label: "Intake / situation review", status: "Pending" },
            { label: "Service plan prepared", status: "Pending" }
          ],
          documents: []
        });

        alert("Client portal account created. You are now logged in as a client.");
      } catch (err) {
        console.error(err);
        alert("Could not register: " + err.message);
      } finally {
        setLoading("register-btn", false, "Register New Client Account", "Registering...");
      }
    }

    async function handleLogin() {
      const emailInput = document.getElementById("login-email");
      const passwordInput = document.getElementById("login-password");

      const email = (emailInput?.value || "").trim();
      const password = passwordInput?.value || "";

      if (!email || !password) {
        alert("Please enter your email and password.");
        return;
      }

      try {
        setLoading("login-btn", true, "Login", "Logging in...");
        await signInWithEmailAndPassword(auth, email, password);
      } catch (err) {
        console.error(err);
        alert("Login failed: " + err.message);
      } finally {
        setLoading("login-btn", false, "Login", "Logging in...");
      }
    }

    async function handleLogout() {
      try {
        await signOut(auth);
      } catch (err) {
        console.error(err);
      }
    }

    // ---------- Auth state listener ----------
    onAuthStateChanged(auth, async (user) => {
      if (!user) {
        applyRoleUI("guest");
        return;
      }

      let role = "client";
      try {
        const userRef = doc(db, "users", user.uid);
        const snap = await getDoc(userRef);
        if (snap.exists()) {
          const data = snap.data();
          if (data.role) role = data.role;
        }
      } catch (err) {
        console.error(err);
      }

      applyRoleUI(role);

      if (role.toLowerCase() === "client") {
        await loadClientFundingStatus(user);
      }
    });

    // Footer year
    const yearEl = document.getElementById("year");
    if (yearEl) {
      yearEl.textContent = new Date().getFullYear();
    }

    // Expose handlers to global scope for onclick
    window.handleRegister = handleRegister;
    window.handleLogin = handleLogin;
    window.handleLogout = handleLogout;
  </script>
</body>
</html>
