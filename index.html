<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>1128 Management Corp — C-Corp Setup • Management • Client Portal</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#050816;
      --panel:#0b1226;
      --panel2:#0a1022;
      --border:rgba(255,255,255,.10);
      --text:#f9fafb;
      --muted:#9ca3af;
      --brand:#2563eb;
      --brand2:#10b981;
      --warn:#f59e0b;
      --danger:#ef4444;
      --ok:#22c55e;
      --shadow: 0 12px 40px rgba(0,0,0,.45);
      --radius:16px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      background: radial-gradient(1200px 700px at 40% 10%, rgba(37,99,235,.22), transparent 60%),
                  radial-gradient(900px 600px at 80% 30%, rgba(16,185,129,.12), transparent 55%),
                  var(--bg);
      color:var(--text);
    }
    a{color:inherit}
    .container{max-width:1100px;margin:0 auto;padding:0 18px}
    .nav{
      position:sticky;top:0;z-index:50;
      backdrop-filter: blur(14px);
      background: rgba(5,8,22,.72);
      border-bottom:1px solid var(--border);
    }
    .nav-inner{display:flex;align-items:center;justify-content:space-between;gap:14px;padding:14px 0}
    .brand{display:flex;align-items:center;gap:10px;font-weight:800;letter-spacing:.3px}
    .logo{
      width:34px;height:34px;border-radius:10px;
      background: linear-gradient(135deg, rgba(37,99,235,.95), rgba(16,185,129,.85));
      display:grid;place-items:center;box-shadow: var(--shadow);
      font-weight:900;
    }
    .nav-links{display:flex;gap:14px;flex-wrap:wrap;align-items:center;justify-content:flex-end}
    .chip{
      padding:8px 12px;border-radius:999px;border:1px solid var(--border);
      background: rgba(255,255,255,.03);
      font-size:13px;color:var(--muted);
    }
    .btn{
      border:0;cursor:pointer;
      padding:10px 14px;border-radius:12px;
      background: var(--brand); color:white;
      font-weight:700;
      box-shadow: 0 10px 24px rgba(37,99,235,.20);
      transition: transform .08s ease, opacity .12s ease;
    }
    .btn:hover{transform: translateY(-1px)}
    .btn:disabled{opacity:.55;cursor:not-allowed;transform:none}
    .btn-outline{
      border:1px solid var(--border);
      background: rgba(255,255,255,.03);
      color: white;
      padding:10px 14px;border-radius:12px;
      cursor:pointer;font-weight:700;
    }
    .btn-green{
      background: linear-gradient(90deg, var(--brand), var(--brand2));
      border:0;
    }
    .hero{padding:54px 0 26px}
    .hero-grid{display:grid;grid-template-columns:1.15fr .85fr;gap:18px;align-items:stretch}
    @media(max-width:960px){.hero-grid{grid-template-columns:1fr}}
    h1{margin:0 0 10px;font-size:40px;line-height:1.1}
    .sub{color:var(--muted);max-width:62ch;font-size:15px;line-height:1.6}
    .panel{
      background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02));
      border:1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
    }
    .panel-pad{padding:18px}
    .grid-3{display:grid;grid-template-columns:repeat(3,1fr);gap:14px}
    @media(max-width:960px){.grid-3{grid-template-columns:1fr}}
    .card{
      background: rgba(0,0,0,.18);
      border:1px solid var(--border);
      border-radius: var(--radius);
      padding:16px;
      min-height:150px;
    }
    .card h3{margin:0 0 8px}
    .card p{margin:0;color:var(--muted);line-height:1.6}
    .bullets{margin:10px 0 0;padding-left:18px;color:#cbd5e1}
    section{padding:34px 0}
    .section-title{display:flex;align-items:flex-end;justify-content:space-between;gap:14px;margin-bottom:12px}
    .section-title h2{margin:0;font-size:22px}
    .kicker{color:#7dd3fc;letter-spacing:.18em;font-size:11px;font-weight:800}
    .muted{color:var(--muted)}
    .products{display:grid;grid-template-columns:1.2fr .8fr;gap:14px}
    @media(max-width:960px){.products{grid-template-columns:1fr}}
    .price{font-size:30px;font-weight:900;margin:6px 0}
    .tag{display:inline-flex;gap:8px;align-items:center;border:1px solid var(--border);border-radius:999px;padding:6px 10px;color:#cbd5e1;background: rgba(255,255,255,.03);font-size:12px}
    .fine{font-size:12px;color:var(--muted);line-height:1.6}
    .hr{height:1px;background:var(--border);margin:12px 0}
    label{display:block;font-size:12px;color:#cbd5e1;margin-top:10px}
    input{
      width:100%;margin-top:6px;
      padding:10px 12px;border-radius:12px;
      border:1px solid var(--border);
      background: rgba(0,0,0,.25);
      color: var(--text);
      outline:none;
    }
    input:focus{border-color: rgba(37,99,235,.55)}
    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    .row > * {flex:1}
    .small{font-size:12px;color:var(--muted)}
    .toast{
      margin-top:10px;
      padding:10px 12px;border-radius:12px;
      border:1px solid var(--border);
      background: rgba(0,0,0,.25);
      color:#e5e7eb;
      display:none;
      white-space:pre-wrap;
    }
    .toast.ok{border-color: rgba(34,197,94,.35)}
    .toast.warn{border-color: rgba(245,158,11,.35)}
    .toast.bad{border-color: rgba(239,68,68,.35)}
    .portal-grid{display:grid;grid-template-columns:1fr 1fr;gap:14px;align-items:start}
    @media(max-width:960px){.portal-grid{grid-template-columns:1fr}}
    table{width:100%;border-collapse:collapse;margin-top:10px}
    th,td{padding:10px;border-bottom:1px solid var(--border);text-align:left;font-size:13px}
    th{color:#cbd5e1;font-weight:800}
    .badge{
      display:inline-flex;align-items:center;gap:8px;
      padding:5px 10px;border-radius:999px;border:1px solid var(--border);
      background: rgba(255,255,255,.03);
      font-size:12px;color:#e5e7eb;
    }
    .badge.pending{border-color: rgba(245,158,11,.35)}
    .badge.done{border-color: rgba(34,197,94,.35)}
    .badge.progress{border-color: rgba(59,130,246,.35)}
    footer{padding:28px 0;border-top:1px solid var(--border);color:var(--muted);text-align:center}
    .hide{display:none!important}
  </style>
</head>

<body>
  <!-- NAV -->
  <div class="nav">
    <div class="container">
      <div class="nav-inner">
        <div class="brand">
          <div class="logo">1128</div>
          <div>
            <div style="font-size:13px;font-weight:900;">1128 MANAGEMENT CORP</div>
            <div style="font-size:12px;color:var(--muted);margin-top:2px;">C-Corp Setup • Management • Client Portal</div>
          </div>
        </div>

        <div class="nav-links">
          <a class="chip" href="#overview">Overview</a>
          <a class="chip" href="#setup">C-Corp Setup</a>
          <a class="chip" href="#addons">Add-On Services</a>
          <a class="chip" href="#policies">Policies</a>
          <a class="chip" href="#portal">Client Portal</a>

          <a class="btn-outline" href="https://buy.stripe.com/4gM00jddY2Q228qanU1ck07" target="_blank" rel="noopener">Buy Credits</a>
          <button class="btn btn-green" id="navPortalBtn" type="button">Client Portal Login</button>
        </div>
      </div>
    </div>
  </div>

  <!-- HERO -->
  <section class="hero" id="overview">
    <div class="container">
      <div class="hero-grid">
        <div class="panel panel-pad">
          <div class="kicker">MISSISSIPPI • MULTI-ENTITY</div>
          <h1>Get your C-Corp set up, organized, and managed — with a secure client portal.</h1>
          <p class="sub">
            We provide service-based setup and business management support. Clients use our portal for status updates,
            documentation backup, and results tracking. Sensitive internal methods are kept private and are never displayed publicly.
          </p>

          <div class="row" style="margin-top:14px;">
            <a class="btn btn-green" href="#setup">View C-Corp Package</a>
            <a class="btn-outline" href="https://buy.stripe.com/4gM00jddY2Q228qanU1ck07" target="_blank" rel="noopener">Buy Credits</a>
          </div>

          <div class="hr"></div>
          <div class="grid-3">
            <div class="card">
              <h3>C-Corp Setup</h3>
              <p>Incorporation + EIN + business contact setup + onboarding.</p>
              <ul class="bullets">
                <li>Service starts within 3 business days</li>
                <li>Minimum expectation for results: ~90 days</li>
              </ul>
            </div>
            <div class="card">
              <h3>Business Management</h3>
              <p>Hands-on operational guidance, like an “undercover boss” style review — focused on systems and execution.</p>
              <ul class="bullets">
                <li>Workflows, compliance, and operations</li>
                <li>Clear action plan and follow-through</li>
              </ul>
            </div>
            <div class="card">
              <h3>Client Portal</h3>
              <p>Each client logs in to see their checklist, updates, and document links.</p>
              <ul class="bullets">
                <li>Read-only status view for clients</li>
                <li>Updates managed by 1128 on the backend</li>
              </ul>
            </div>
          </div>
        </div>

        <div class="panel panel-pad">
          <div class="tag">Top actions</div>
          <h3 style="margin-top:10px;">Quick links</h3>
          <p class="fine">Use these for promotion and fast access.</p>

          <div class="row" style="margin-top:10px;">
            <a class="btn btn-green" href="https://buy.stripe.com/4gM00jddY2Q228qanU1ck07" target="_blank" rel="noopener">Buy Credits</a>
            <button class="btn-outline" id="heroPortalBtn" type="button">Client Portal Login</button>
          </div>

          <div class="hr"></div>
          <div class="fine">
            Credits are public. The client portal is private and requires an email + password login.
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- C-CORP PACKAGE -->
  <section id="setup">
    <div class="container">
      <div class="section-title">
        <div>
          <div class="kicker">C-CORP SETUP PACKAGE</div>
          <h2>$300 Total Bundle</h2>
          <div class="muted">Service fee — state/government fees are included.</div>
        </div>
        <a class="btn btn-green" href="#portal">Client Portal</a>
      </div>

      <div class="products">
        <div class="panel panel-pad">
          <div class="tag">What’s included</div>
          <div class="price">$300</div>
          <ul class="bullets">
            <li>Incorporation filing (C-Corp only)</li>
            <li>IRS EIN application support</li>
            <li>Business address setup (no approval required)</li>
            <li>Business phone number setup</li>
            <li>Business email setup</li>
            <li>Basic website setup</li>
            <li>Banking setup assistance</li>
            <li>Payment processing setup assistance</li>
            <li>Client portal access for updates + documentation backup</li>
          </ul>

          <div class="row" style="margin-top:14px;">
            <a class="btn btn-green" href="#portal">Sign in / Register</a>
            <a class="btn-outline" href="https://buy.stripe.com/4gM00jddY2Q228qanU1ck07" target="_blank" rel="noopener">Buy Credits</a>
          </div>

          <div class="hr"></div>
          <div class="fine">
            Processing begins within <b>3 business days</b> of signup and intake. Minimum expectation for full results is approximately <b>90 days</b>.
          </div>
        </div>

        <div class="panel panel-pad">
          <div class="tag">Public credits</div>
          <h3 style="margin:10px 0 8px;">Support Credits</h3>
          <p class="fine">Credits are public-facing and can be purchased anytime.</p>

          <div class="card" style="margin-top:12px;">
            <h3 style="margin:0 0 6px;">Buy Credits</h3>
            <p class="fine">Minimum is $5. Quantity is adjustable in Stripe Checkout.</p>
            <div class="row" style="margin-top:10px;">
              <a class="btn btn-green" href="https://buy.stripe.com/4gM00jddY2Q228qanU1ck07" target="_blank" rel="noopener">Buy Credits ($5+)</a>
              <a class="btn-outline" href="#policies">Refund policy</a>
            </div>
          </div>

          <div class="card" style="margin-top:12px;">
            <h3 style="margin:0 0 6px;">Optional credit bundles</h3>
            <p class="fine">$5 • $10 • $20 (choose quantity in checkout)</p>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- ADD-ON SERVICES -->
  <section id="addons">
    <div class="container">
      <div class="section-title">
        <div>
          <div class="kicker">ADD-ON SERVICES</div>
          <h2>Optional add-ons (recommended pricing)</h2>
          <div class="muted">Add-ons can be purchased as needed after onboarding.</div>
        </div>
      </div>

      <div class="grid-3">
        <div class="card">
          <h3>Website Build / Rebuild</h3>
          <p class="price" style="font-size:22px">$399</p>
          <p>Landing page, service structure, and portal linking.</p>
        </div>
        <div class="card">
          <h3>Business Phone & Email Setup</h3>
          <p class="price" style="font-size:22px">$89</p>
          <p>Business identity essentials configured cleanly.</p>
        </div>
        <div class="card">
          <h3>Corporate Document Creation</h3>
          <p class="price" style="font-size:22px">$89–$399</p>
          <p>Customized documents based on scope.</p>
        </div>
        <div class="card">
          <h3>Payment Processor Setup</h3>
          <p class="price" style="font-size:22px">$199</p>
          <p>Stripe/Square setup assistance and configuration checks.</p>
        </div>
        <div class="card">
          <h3>Business Systems Setup</h3>
          <p class="price" style="font-size:22px">$299</p>
          <p>CRM, portal structure, workflows, basic automation.</p>
        </div>
        <div class="card">
          <h3>Business Management (Undercover-Boss Style)</h3>
          <p class="price" style="font-size:22px">$999</p>
          <p>Operational review, fixes, and an execution plan.</p>
        </div>
      </div>
    </div>
  </section>

  <!-- POLICIES -->
  <section id="policies">
    <div class="container">
      <div class="section-title">
        <div>
          <div class="kicker">POLICIES</div>
          <h2>Timeline, refunds & credits</h2>
          <div class="muted">Clear expectations for service-based work.</div>
        </div>
      </div>

      <div class="products">
        <div class="panel panel-pad">
          <h3 style="margin:0 0 8px;">Timeline for work</h3>
          <ul class="bullets">
            <li>We aim to begin active processing within <b>3 business days</b> after signup and intake.</li>
            <li>The minimum expectation for total results is about <b>90 days</b>.</li>
            <li>Some items (state processing, IRS response, bank/processor approvals) are controlled by those institutions.</li>
          </ul>
        </div>

        <div class="panel panel-pad">
          <h3 style="margin:0 0 8px;">Refunds & credits</h3>
          <ul class="bullets">
            <li>Service fees paid to 1128 Management Corp are generally <b>non-refundable</b>.</li>
            <li>Any exceptions or adjustments must follow applicable law and the policies/procedures of our payment processor (Stripe).</li>
            <li>If there is a clear service error on our side, we will review the situation and work toward a fair resolution under Stripe’s process.</li>
          </ul>
        </div>
      </div>
    </div>
  </section>

  <!-- CLIENT PORTAL (BOTTOM) -->
  <section id="portal">
    <div class="container">
      <div class="section-title">
        <div>
          <div class="kicker">CLIENT PORTAL</div>
          <h2>Track your setup, management, and documentation in one place.</h2>
          <div class="muted">Clients must log in each session. Registration is client-only.</div>
        </div>
      </div>

      <div class="portal-grid">
        <!-- How it works -->
        <div class="panel panel-pad">
          <h3 style="margin:0 0 8px;">How the client portal works</h3>
          <ol class="bullets">
            <li>You complete payment and intake.</li>
            <li>You create your portal login using your email + password.</li>
            <li>1128 initializes your checklist and updates your file in the system.</li>
            <li>When you log in, you can see status + checklist + document links (if added).</li>
          </ol>
          <div class="fine" style="margin-top:10px;">
            Clients see a read-only view. 1128 updates items from the backend.
          </div>
        </div>

        <!-- Login box -->
        <div class="panel panel-pad">
          <h3 style="margin:0 0 8px;">Client Login</h3>
          <div class="fine">New registrations created here are automatically treated as Clients.</div>

          <label>Email</label>
          <input id="email" placeholder="you@email.com" autocomplete="email">

          <label>Password</label>
          <input id="password" type="password" placeholder="••••••••" autocomplete="current-password">

          <div class="row" style="margin-top:12px;">
            <button class="btn btn-green" id="loginBtn" type="button">Login</button>
            <button class="btn-outline" id="registerBtn" type="button">Register New Client Account</button>
          </div>

          <div class="toast" id="msg"></div>
          <div class="small" style="margin-top:10px;">
            Tip: If login seems slow, watch for the “Signing in…” message. The portal will switch automatically once authenticated.
          </div>

          <div class="hr"></div>

          <div class="row">
            <span class="badge" id="authBadge">Not signed in</span>
            <button class="btn-outline hide" id="logoutBtn" type="button">Logout</button>
          </div>
        </div>
      </div>

      <!-- Status panel -->
      <div class="panel panel-pad" style="margin-top:14px;" id="statusPanel">
        <div class="row" style="align-items:flex-start;">
          <div style="flex:1.2">
            <h3 style="margin:0 0 6px;">Client Checklist & Status</h3>
            <div class="fine">This section appears only after you log in.</div>
          </div>
          <div style="flex:.8;text-align:right;">
            <div class="small">Logged in as:</div>
            <div style="font-weight:900" id="who">—</div>
          </div>
        </div>

        <div class="hr"></div>

        <div class="row" style="align-items:center;gap:10px;">
          <div class="small">Overall status:</div>
          <span class="badge pending" id="overallBadge">Pending</span>
          <span class="small" id="updatedAtText"></span>
        </div>

        <table>
         <thead>
  <tr>
    <th>Item</th>
    <th>Status</th>
    <th>Notes</th>
  </tr>
</thead>
<tbody id="client-steps-body"></tbody>

        </table>

        <div class="fine" style="margin-top:10px;">
          If something looks incorrect, contact 1128 directly. Portal data is updated by 1128 after work is completed or moved forward.
        </div>
      </div>
    </div>
  </section>

  <footer>
    © <span id="year"></span> 1128 Management Corp. Client Portal.
  </footer>

  <script type="module">
    // Firebase SDK
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-app.js";
    import {
      getAuth,
      setPersistence,
      browserSessionPersistence,
      onAuthStateChanged,
      createUserWithEmailAndPassword,
      signInWithEmailAndPassword,
      signOut
    } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-auth.js";

    import {
      getFirestore,
      doc,
      getDoc,
      setDoc,
      serverTimestamp
    } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-firestore.js";

    // Your Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyDWgaRI40PO-fgP8xa_m1OWg-3AgOKCQW4",
      authDomain: "management-portal-da4aa.firebaseapp.com",
      projectId: "management-portal-da4aa",
      storageBucket: "management-portal-da4aa.firebasestorage.app",
      messagingSenderId: "336550662632",
      appId: "1:336550662632:web:da5a240a56fdd2df3a145d",
      measurementId: "G-CCWG9GVVS7"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // Force login each time (no long-term persistence)
    await setPersistence(auth, browserSessionPersistence);

    // UI refs
    const $ = (id) => document.getElementById(id);
    const email = $("email");
    const password = $("password");
    const loginBtn = $("loginBtn");
    const registerBtn = $("registerBtn");
    const logoutBtn = $("logoutBtn");
    const msg = $("msg");
    const authBadge = $("authBadge");
    const stepsTable = $("stepsTable");
    const overallBadge = $("overallBadge");
    const who = $("who");
    const updatedAtText = $("updatedAtText");

    $("year").textContent = new Date().getFullYear();

    // Scroll helpers
    const goPortal = () => document.querySelector("#portal")?.scrollIntoView({behavior:"smooth", block:"start"});
    $("navPortalBtn").addEventListener("click", goPortal);
    $("heroPortalBtn").addEventListener("click", goPortal);

    function setMsg(text, kind="warn"){
      msg.className = "toast " + (kind || "");
      msg.style.display = "block";
      msg.textContent = text;
    }
    function clearMsg(){
      msg.style.display = "none";
      msg.textContent = "";
      msg.className = "toast";
    }
    function setBusy(isBusy, label){
      loginBtn.disabled = isBusy;
      registerBtn.disabled = isBusy;
      loginBtn.textContent = isBusy ? (label || "Working...") : "Login";
      registerBtn.textContent = isBusy ? "Please wait..." : "Register New Client Account";
    }

    function badgeForStatus(status){
      const s = String(status || "").toLowerCase();
      if (s.includes("complete") || s === "done") return {cls:"done", text:status};
      if (s.includes("progress") || s.includes("active")) return {cls:"progress", text:status};
      return {cls:"pending", text:status || "Pending"};
    }

    function renderChecklist(data){
      const overall = badgeForStatus(data?.overallStatus || "Pending");
      overallBadge.className = "badge " + overall.cls;
      overallBadge.textContent = overall.text;

      stepsTable.innerHTML = "";
      const steps = Array.isArray(data?.steps) ? data.steps : [];

      if (!steps.length){
        stepsTable.innerHTML = `<tr><td colspan="2" class="muted">No checklist found yet.</td></tr>`;
        return;
      }

      for (const step of steps){
        const label = step?.label ?? "—";
        const st = badgeForStatus(step?.status ?? "Pending");
        const statusChip = `<span class="badge ${st.cls}">${st.text}</span>`;
        const tr = document.createElement("tr");
        tr.innerHTML = `<td>${label}</td><td>${statusChip}</td>`;
        stepsTable.appendChild(tr);
      }
    }

    // Default template created ONCE for a new client
    const defaultSteps = [
      "Business Name","Address","Phone Number","Website","Email Address",
      "State Filing","EIN","Banking Setup","Payment Processing"
    ].map(label => ({ label, status: "Pending" }));

    async function ensureClientStatusDoc(uid){
      // Read existing
      const ref = doc(db, "clientStatus", uid);
      const snap = await getDoc(ref);
      if (snap.exists()) return snap.data();

      // Create if missing (rules allow create once)
      await setDoc(ref, {
        overallStatus: "Pending",
        steps: defaultSteps,
        updatedAt: serverTimestamp()
      });

      const snap2 = await getDoc(ref);
      return snap2.exists() ? snap2.data() : null;
    }

    // Auth listener
    onAuthStateChanged(auth, async (user) => {
      clearMsg();

      if (!user){
        authBadge.textContent = "Not signed in";
        authBadge.className = "badge";
        logoutBtn.classList.add("hide");
        who.textContent = "—";
        updatedAtText.textContent = "";
        renderChecklist(null);
        return;
      }

      authBadge.textContent = "Signed in";
      authBadge.className = "badge";
      logoutBtn.classList.remove("hide");
      who.textContent = user.email || user.uid;

      try{
        const data = await ensureClientStatusDoc(user.uid);
        renderChecklist(data);

        // updatedAt display (best-effort)
        const updatedAt = data?.updatedAt?.toDate?.();
        updatedAtText.textContent = updatedAt ? `Last updated: ${updatedAt.toLocaleString()}` : "";
      } catch (e){
        setMsg(
          "Signed in, but could not load your checklist.\n\nMost common fixes:\n• Firestore Rules (allow read for clientStatus/{uid})\n• Document ID must equal your Auth UID\n\nError: " + (e?.message || e),
          "bad"
        );
      }
    });

    // Login
    loginBtn.addEventListener("click", async () => {
      clearMsg();
      const em = email.value.trim();
      const pw = password.value;

      if (!em || !pw) return setMsg("Enter email and password.", "warn");

      setBusy(true, "Signing in...");
      try{
        await signInWithEmailAndPassword(auth, em, pw);
        // Clear fields after success
        email.value = "";
        password.value = "";
        setMsg("Signed in. Loading your checklist...", "ok");
        setTimeout(clearMsg, 1500);
      } catch (e){
        setMsg("Login failed: " + (e?.message || e), "bad");
      } finally {
        setBusy(false);
      }
    });

    // Register
    registerBtn.addEventListener("click", async () => {
      clearMsg();
      const em = email.value.trim();
      const pw = password.value;

      if (!em || !pw) return setMsg("Enter email and password.", "warn");
      if (pw.length < 6) return setMsg("Password must be at least 6 characters.", "warn");

      setBusy(true, "Creating...");
      try{
        const cred = await createUserWithEmailAndPassword(auth, em, pw);

        // Clear fields immediately
        email.value = "";
        password.value = "";

        // Create checklist doc (clientStatus/{uid}) if allowed by rules
        try{
          await ensureClientStatusDoc(cred.user.uid);
        } catch (inner){
          // If rules block creation, client is still registered; admin can create the doc manually
          setMsg(
            "Account created, but checklist doc could not be initialized automatically.\n" +
            "You can still sign in.\n\nError: " + (inner?.message || inner),
            "warn"
          );
          return;
        }

        setMsg("Client account created. Loading your portal...", "ok");
        setTimeout(clearMsg, 1500);

      } catch (e){
        setMsg("Could not register: " + (e?.message || e), "bad");
      } finally {
        setBusy(false);
      }
    });

    // Logout
    logoutBtn.addEventListener("click", async () => {
      clearMsg();
      setBusy(true, "Signing out...");
      try{
        await signOut(auth);
        setMsg("Signed out.", "ok");
        setTimeout(clearMsg, 900);
      } catch (e){
        setMsg("Logout failed: " + (e?.message || e), "bad");
      } finally {
        setBusy(false);
      }
    });
  </script>
</body>
</html>

